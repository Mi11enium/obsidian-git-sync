# Ссылочная целостность
Нарушение ссылочной целостности может быть нарушена при выполнении одной из четырех операций:
- Обновление записей в родительской таблице
- Удаление записей в родительской таблице
- Вставка записей в дочерней таблице
- Обновление записей в дочерней таблице

## Существуют стратегии поддержания ссылочной целостности

RESTRICT (Ограничить) - не разрешать выполнение операции, приводящей к нарушению ссылочной целостности.
CASCADE (Каскадное изменение) - разрешить выполнение операции, но при этом внести необходимые изменения в таблицах так, чтобы не допустить нарушение ссылочной целостности и сохранить все имеющиеся связи.

# Внешние ключи
<mark style="background: #BBFABBA6;">Мы создаем несколько классов из одного, если в классе объекты могут дублироваться</mark> 

Пример (Таблица Books):
| Book               | Author          | Publisher   |
| ------------------ | --------------- | ----------- |
| Война и мир        | Лев Толстой     | Росмэн      |
| Рассказы           | Лев Толстой     | Просвещение |
| Мастер и Маргарита | Михаил Булгаков | Росмэн      |
| Повести            | Михаил Булгаков | Мир         |

т.к у нас повторяются наименования в строках, то лучше создать для них отдельные таблицы и сделать внешние ключи со ссылкой на таблицу Books

Внешний ключ в таблице - это ссылка на номер первичного ключа в другой таблице, данные которых нужно притянуть в текущую таблицу.

Чтобы притянуть данные по внешнему ключу, они уже должны быть внесены в другие таблицы!

Таблица с внешним ключом называется дочерней таблицей, а таблица с первичным ключом называется ссылочной или родительской таблицей.

Правило внешнего ключа гарантирует, что при создании записей в дочерней таблице, значение поля, являющегося внешним ключом, есть в родительской таблице.

При добавлении новых записей через (INSERT INTO) в таблицу где есть внешние ключы, мы должны указывать не значение, а номер значения для внешней таблицы.

Первичный ключ отвечает за обеспечение однозначного определения каждой записи внутри одной таблицы. Внешний же ключ отвечает за ссылочную целостность.
Пример после разделения:

Таблица Authors
| AuthorID | Author      |
| -------- | ----------- |
| 1        | Лев Толстой |
| 2        | Михаил Булгаков            |

Таблица Publishers
| PublisherID | Publisher   |
| ----------- | ----------- |
| 1           | Просвещение |
| 2           | Росмэн      |
| 3           | Мир            |

Таблица Books
| BookID | Book               | Author | Publisher |
| ------ | ------------------ | ------ | --------- |
| 1      | Война и мир        | 1      | 2         |
| 2      | Рассказы           | 1      | 1         |
| 3      | Мастер и маргарита | 2      | 2         |
| 4      | Повести            | 2      | 3          |


Для того, чтобы вывести таблицу с названиями (а не с внешними ключами), неободимо использовать
# INNER JOIN
![[Pasted image 20230516160742.png]]

Изучить
HAVING используется для фильтрации результатов агрегатных функций после группировки данных.

Индексы в базе данных используются для ускорения выполнения запросов, позволяя быстрый доступ к данным в таблицах. Они помогают улучшить производительность запросов.

Подзапросы

Транзакции в SQL используются для группировки операций базы данных в логическую единицу работы, где все операции либо успешно выполняются, либо не выполняются вообще. Транзакции обеспечивают целостность данных.
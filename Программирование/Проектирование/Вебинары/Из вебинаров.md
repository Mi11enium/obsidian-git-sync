# Ссылочная целостность
Нарушение ссылочной целостности может быть нарушена при выполнении одной из четырех операций:
- Обновление записей в родительской таблице
- Удаление записей в родительской таблице
- Вставка записей в дочерней таблице
- Обновление записей в дочерней таблице

## Существуют стратегии поддержания ссылочной целостности

RESTRICT (Ограничить) - не разрешать выполнение операции, приводящей к нарушению ссылочной целостности.
CASCADE (Каскадное изменение) - разрешить выполнение операции, но при этом внести необходимые изменения в таблицах так, чтобы не допустить нарушение ссылочной целостности и сохранить все имеющиеся связи.

# Внешние ключи
<mark style="background: #BBFABBA6;">Мы создаем несколько классов из одного, если в классе объекты могут дублироваться</mark> 

Пример (Таблица Books):
| Book               | Author          | Publisher   |
| ------------------ | --------------- | ----------- |
| Война и мир        | Лев Толстой     | Росмэн      |
| Рассказы           | Лев Толстой     | Просвещение |
| Мастер и Маргарита | Михаил Булгаков | Росмэн      |
| Повести            | Михаил Булгаков | Мир         |

т.к у нас повторяются наименования в строках, то лучше создать для них отдельные таблицы и сделать внешние ключи со ссылкой на таблицу Books

Внешний ключ в таблице - это ссылка на номер первичного ключа в другой таблице, данные которых нужно притянуть в текущую таблицу.

Чтобы притянуть данные по внешнему ключу, они уже должны быть внесены в другие таблицы!

Таблица с внешним ключом называется дочерней таблицей, а таблица с первичным ключом называется ссылочной или родительской таблицей.

Правило внешнего ключа гарантирует, что при создании записей в дочерней таблице, значение поля, являющегося внешним ключом, есть в родительской таблице.

Первичный ключ отвечает за обеспечение однозначного определения каждой записи внутри одной таблицы. Внешний же ключ отвечает за ссылочную целостность.
Пример после разделения:

Таблица Authors
| AuthorID | Author      |
| -------- | ----------- |
| 1        | Лев Толстой |
| 2        | Михаил Булгаков            |

Таблица Publishers
| PublisherID | Publisher   |
| ----------- | ----------- |
| 1           | Просвещение |
| 2           | Росмэн      |
| 3           | Мир            |

Таблица Books
| BookID | Book               | Author | Publisher |
| ------ | ------------------ | ------ | --------- |
| 1      | Война и мир        | 1      | 2         |
| 2      | Рассказы           | 1      | 1         |
| 3      | Мастер и маргарита | 2      | 2         |
| 4      | Повести            | 2      | 3          |


# Работа с данными
## Просмотр таблицы (SELECT)
<mark style="background: #FFB86CA6;">SELECT * FROM</mark> table_name;

ИЛИ

<mark style="background: #FFB86CA6;">SELECT</mark> atr_name, atr2_name <mark style="background: #FFB86CA6;">FROM</mark> table_name;

## Представление (AS)
SELECT <mark style="background: #FFB86CA6;">Author AS Автор, Books_title AS Название</mark> FROM Books;

ИЛИ Как представление вычесления

SELECT <mark style="background: #FFB86CA6;">Price * Amount AS Total FROM</mark> Books;

ИЛИ Как представление вычесления с функцией

SELECT IIF(Amount<200, Round(Price\*0.5, 2), Round(Price\*0.8, 2)) AS Sale FROM Books

## Фильтр (WHERE)
SELECT Author, Book, Publisher, Amount, Price
FROM Books
WHERE Amount < 40 AND PRICE > 100;

ИЛИ с диапазоном (между)

SELECT Author, Book, Publisher, Amount, Price
FROM Books
WHERE Amount BETWEEN 1 AND 40;

ИЛИ по индексу (содержит)

SELECT Author, Book, Publisher, Amount, Price
FROM Books
WHERE Price IN(40, 113, 450)

## Сортировка (ORDER BY)
SELECT Author, Book, Publisher, Amount, Price
FROM Books
WHERE Price IN(1, 115, 450)
<mark style="background: #FFB86CA6;">ORDER BY</mark> Amount;

Или по убыванию

SELECT Author, Book, Publisher, Amount, Price
FROM Books
WHERE Price IN(1, 115, 450)
<mark style="background: #FFB86CA6;">ORDER BY</mark> Amount <mark style="background: #FFB86CA6;">DESC</mark> ;

## Представление по шаблону (LIKE)
SELECT Author, Book, Publisher, Amount, Price
FROM Books
<mark style="background: #FFB86CA6;">WHERE</mark> Book <mark style="background: #FFB86CA6;">LIKE ("%и")</mark> ; // процент - это метасимвол от 0 до бесконечности

ИЛИ

SELECT Author, Book, Publisher, Amount, Price
FROM Books
<mark style="background: #FFB86CA6;">WHERE</mark> Book <mark style="background: #FFB86CA6;">LIKE("__с%")</mark> ; // \_ - один любой символ
# Работа с таблицами
## Добавление значения (INSERT INTO)

Добавлять данные (значения) в таблицу мы можем только если мы знаем её структуру и порядок атрибутов.
Если атрибут внешний, то мы должны знать ID этого атрибута.

Шаблон добавления:
<mark style="background: #FFB86CA6;">INSERT INTO</mark> Table_name
<mark style="background: #FFB86CA6;">VALUES</mark> (empty_value, col2_value...),
    (empty1_value, col2_value...);

ИЛИ

<mark style="background: #FFB86CA6;">INSERT INTO</mark> Table_name (atr_name, atr_name2)
<mark style="background: #FFB86CA6;">VALUES</mark> (value_atr_name, value_atr_name2...),
    (empty1_value, col2_value...);